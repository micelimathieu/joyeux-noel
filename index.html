<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Joyeux No√´l !</title>
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&display=swap" rel="stylesheet">
    
    <style>
        body {
            background-color: #0f172a; 
            color: #fff;
            font-family: 'Mountains of Christmas', cursive;
            margin: 0;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        #sleigh-container {
            position: absolute;
            top: 5vh; 
            left: -100vw; 
            font-size: 3em;
            white-space: nowrap;
            z-index: 9; 
            animation: none; 
        }
        
        @keyframes flyAcross {
            0% { transform: translateX(0vw); } 
            100% { transform: translateX(200vw); } 
        }
        
        #main-content {
            display: flex;
            align-items: center; 
            justify-content: center;
            width: 100%;
            height: 100%;
            gap: 50px; 
            padding: 0 5%;
            box-sizing: border-box;
            position: relative; 
            z-index: 10;
        }

        /* --- Styles du Sapin de No√´l --- */
        .tree-wrapper { flex-shrink: 0; padding-bottom: 50px; }
        .tree-container { position: relative; animation: sway 3s infinite ease-in-out alternate; transform: scale(1.5); }
        .star { 
            width: 0; height: 0; 
            border-left: 10px solid transparent; 
            border-right: 10px solid transparent; 
            border-bottom: 20px solid #fbbf24; 
            position: absolute; 
            top: -20px; 
            left: 50%; 
            transform: translateX(-50%); 
            filter: drop-shadow(0 0 10px #fbbf24); 
            z-index: 10; 
        }
        .layer { 
            width: 0; height: 0; 
            border-left: solid transparent; 
            border-right: solid transparent; 
            border-bottom: solid #166534; 
            position: absolute; 
            left: 50%; 
            transform: translateX(-50%); 
        }
        .layer-1 { border-left-width: 30px; border-right-width: 30px; border-bottom-width: 40px; top: 0; z-index: 3; }
        .layer-2 { border-left-width: 50px; border-right-width: 50px; border-bottom-width: 60px; top: 20px; z-index: 2; }
        .layer-3 { border-left-width: 70px; border-right-width: 70px; border-bottom-width: 80px; top: 50px; z-index: 1; }
        .trunk { width: 20px; height: 30px; background: #451a03; position: absolute; top: 130px; left: 50%; transform: translateX(-50%); }
        .bauble { width: 8px; height: 8px; border-radius: 50%; position: absolute; animation: blink 1s infinite step-end; }
        .b1 { background: red; top: 35px; left: -10px; } 
        .b2 { background: gold; top: 65px; left: 15px; animation-delay: 0.3s; } 
        .b3 { background: red; top: 90px; left: -25px; animation-delay: 0.6s; }
        /* --- Fin Styles du Sapin --- */
        
        #lyrics-container { 
            font-size: 2.5rem; 
            text-align: left; 
            width: 40%; 
            min-height: 80px; 
            padding: 20px; 
            text-shadow: 0 0 10px rgba(255,255,255,0.5); 
            transition: opacity 0.5s ease; 
            opacity: 0; 
            line-height: 1.5; 
            color: #fff;
            position: relative;
        }
        #overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; z-index: 100; flex-direction: column; cursor: pointer; }
        #overlay h1 { font-size: 3rem; margin: 0; color: #fbbf24; }
        #overlay p { font-size: 1.5rem; margin-top: 10px; }

        .word {
            opacity: 0.3; 
            transition: opacity 0.1s;
        }

        .revealed {
            opacity: 1; 
            color: #fbbf24; 
            text-shadow: 0 0 15px #fbbf24;
        }
        
        /* üñºÔ∏è Styles pour l'image de fin et les images suppl√©mentaires */
        #image-1, #image-2, #image-3, #image-4, #image-5, #image-6, #image-7 {
            position: fixed; 
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 40%; 
            max-height: 80vh;
            opacity: 0; 
            transition: opacity 0.5s ease-in-out; 
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(255,255,255,0.7);
            pointer-events: none; 
        }
        #image-1.show, #image-2.show, #image-3.show, #image-4.show, #image-5.show, #image-6.show, #image-7.show {
            opacity: 1;
        }
        
        #image-1, #image-2, #image-3, #image-4, #image-5, #image-6, #image-7 {
            z-index: 10;
        }

        /* Animations */
        @keyframes sway { from { transform: rotate(-2deg) scale(1.5); } to { transform: rotate(2deg) scale(1.5); } }
        @keyframes blink { 0% { opacity: 1; box-shadow: 0 0 10px currentColor; } 50% { opacity: 0.3; box-shadow: none; } 100% { opacity: 1; box-shadow: 0 0 10px currentColor; } }
        
        /* Neige et objets qui tombent */
        .snowflake { position: fixed; top: -10px; color: #fff; font-size: 1em; animation-name: fall; animation-timing-function: linear; animation-iteration-count: infinite; z-index: 1; text-shadow: 0 0 5px rgba(255,255,255,0.5); }
        @keyframes fall { to { transform: translateY(105vh); } }
        .falling-item { position: fixed; top: -50px; font-size: 2em; animation: fallAndSway linear infinite; z-index: 2; opacity: 0; }
        @keyframes fallAndSway { 0% { transform: translate(0, -10vh) rotate(0deg); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translate(var(--end-x), 105vh) rotate(var(--end-rotation)); opacity: 0; } }

    </style>
</head>
<body>

    <div id="overlay">
        <h1>üéÅ</h1>
        <p>Cliquez pour ouvrir votre carte</p>
    </div>

    <div id="sleigh-container" class="sleigh-hidden">
        ü¶åü¶åü¶åüéÖ 
    </div>

    <div id="main-content">
        <div class="tree-wrapper">
            <div class="tree-container">
                <div class="star"></div>
                <div class="layer layer-1"><div class="bauble b1"></div></div>
                <div class="layer layer-2"><div class="bauble b2"></div></div>
                <div class="layer layer-3"><div class="bauble b3"></div></div>
                <div class="trunk"></div>
            </div>
        </div>
        
        <div id="lyrics-container"></div>
    </div>

    <audio id="audio-player">
        <source src="last-christmas.mp3" type="audio/mpeg">
        Votre navigateur ne supporte pas l'audio.
    </audio>
    
    <img id="image-1" src="chien.jpg" alt="Image Chien">
    
    <img id="image-2" src="elise-L.jpg" class="extra-image" alt="Image Elise L">
    <img id="image-3" src="elise-M.jpg" class="extra-image" alt="Image Elise M">
    <img id="image-4" src="popo.jpg" class="extra-image" alt="Image Popo">
    <img id="image-5" src="marine.jpg" class="extra-image" alt="Image Marine">
    <img id="image-6" src="felise.jpg" class="extra-image" alt="Image F√©lise">
    <img id="image-7" src="lolo.jpg" class="extra-image" alt="Image Lolo">

    <script>
        // 1. Configuration des paroles et du timing (en secondes)
        const lyricsData = [
            { time: 28, text: "üé∂ reste jusqu'a la fin :) üé∂" }, 
            { time: 46, words: [
                { time: 46.0, text: "Last" },
                { time: 46.5, text: "Christmas," },
                { time: 47.5, text: "I" },
                { time: 47.7, text: "gave" },
                { time: 47.9, text: "you" },
                { time: 48.1, text: "my" },
                { time: 48.3, text: "heart" },
            ]},
            { time: 50.8, words: [
                { time: 50.8, text: "But" },
                { time: 51.1, text: "the" },
                { time: 51.3, text: "very" },
                { time: 51.6, text: "next" },
                { time: 51.9, text: "day" },
            ]},
            { time: 52.9, words: [
                { time: 52.9, text: "You" },
                { time: 53.1, text: "gave" },
                { time: 53.3, text: "it" },
                { time: 53.5, text: "away" },
            ]},
            { time: 55.9, words: [
                { time: 55.9, text: "This" },
                { time: 56.1, text: "year," },
                { time: 56.4, text: "to" },
                { time: 56.7, text: "save" },
                { time: 57.0, text: "me" },
                { time: 57.2, text: "from" },
                { time: 57.5, text: "tears" },
            ]},
            { time: 59.8, words: [
                { time: 59.8, text: "I'll" },
                { time: 60.1, text: "give" },
                { time: 60.3, text: "it" },
                { time: 60.5, text: "to" },
                { time: 60.7, text: "someone" },
                { time: 61.2, text: "special." },
            ]},
            { time: 61.3, sequence: [
                // ‚ùó NOUVEAUX D√âLAIS (4000ms = 4 secondes)
                { id: "image-2", delay: 0 },         // 61.3s : Image Elise L
                { id: "image-3", delay: 4000 },      // 65.3s : Image Elise M
                { id: "image-4", delay: 8000 },      // 69.3s : Image Popo
                { id: "image-5", delay: 12000 },     // 73.3s : Image Marine
                { id: "image-6", delay: 16000 },     // 77.3s : Image F√©lise
                { id: "image-7", delay: 20000 },     // 81.3s : Image Lolo
                { id: "image-1", delay: 24000 },     // 85.3s : Image Chien (Derni√®re image)
            ]},
            { time: 89.8, text: "joyeux Noel les pouffiasses <3 <3" }, 
        ];

        const audio = document.getElementById('audio-player');
        const lyricsContainer = document.getElementById('lyrics-container');
        const overlay = document.getElementById('overlay');
        const sleighContainer = document.getElementById('sleigh-container');
        
        // üñºÔ∏è R√âF√âRENCES D'IMAGES MISES √Ä JOUR (7 images)
        const sequenceImageIds = ["image-1", "image-2", "image-3", "image-4", "image-5", "image-6", "image-7"];
        
        const startTime = 28; 

        // Variables de suivi
        let currentLineIndex = -1;
        let currentWordIndex = -1;
        let imageTimer = null; 
        let currentSequenceIndex = -1; // Index de l'image actuellement affich√©e

        // Fonction pour g√©rer l'affichage s√©quentiel des images
        function displayImageSequence(sequence) {
            currentSequenceIndex = -1; 
            
            sequence.forEach((item) => {
                let currentItemIndex = sequenceImageIds.indexOf(item.id);

                setTimeout(() => {
                    // Cacher l'image pr√©c√©dente (si elle existe)
                    if (currentSequenceIndex >= 0) {
                        const prevId = sequenceImageIds[currentSequenceIndex];
                        const prevImage = document.getElementById(prevId);
                        if(prevImage) prevImage.classList.remove('show');
                    }
                    
                    // Afficher l'image actuelle
                    const currentImage = document.getElementById(item.id);
                    if (currentImage) {
                        // Cacher toutes les images d'abord, pour la propret√©
                        sequenceImageIds.forEach(id => document.getElementById(id).classList.remove('show'));
                        
                        // Afficher et mettre au-dessus l'image actuelle
                        currentImage.classList.add('show');
                        currentImage.style.zIndex = 11;

                        currentSequenceIndex = currentItemIndex;
                    }

                }, item.delay);
            });
            
            // Cacher toutes les images apr√®s la fin de la s√©quence d'images (3 secondes apr√®s la derni√®re image du chien)
            const finalDelay = sequence[sequence.length - 1].delay + 3000;
            setTimeout(() => {
                sequenceImageIds.forEach(id => document.getElementById(id).classList.remove('show'));
            }, finalDelay);
        }


        // 2. D√©marrage au clic (inchang√©)
        overlay.addEventListener('click', () => {
            overlay.style.opacity = '0';
            setTimeout(() => overlay.style.display = 'none', 500);
            
            audio.currentTime = startTime;

            audio.play()
                .then(() => {
                    console.log("Lecture audio d√©marr√©e avec succ√®s.");
                    launchSleighAnimation(); 
                })
                .catch(error => {
                    console.error("√âchec de la lecture audio (Erreur Autoplay ?):", error);
                    if (error.name === "NotAllowedError") {
                        alert("Le navigateur a bloqu√© le son. Veuillez cliquer √† nouveau.");
                    }
                });
            
            lyricsContainer.style.opacity = '1';
            createSnow(100); 
            createFallingItems(30); 
        });

        // 3. Fonction pour lancer le tra√Æneau (inchang√©e)
        function launchSleighAnimation() {
            sleighContainer.style.opacity = 1;
            sleighContainer.style.animation = 'flyAcross 10s linear forwards'; 
            sleighContainer.addEventListener('animationend', () => {
                sleighContainer.style.opacity = 0;
                sleighContainer.style.animation = 'none';
                setTimeout(launchSleighAnimation, 10000); 
            }, { once: true }); 
        }
        
        // 4. Synchronisation des paroles
        audio.addEventListener('timeupdate', () => {
            const currentTime = audio.currentTime;
            let lineChanged = false;

            // 4a. D√©terminer la ligne actuelle
            const nextLineIndex = lyricsData.findIndex((line, index) => 
                (index === lyricsData.length - 1 || currentTime < lyricsData[index + 1].time) && currentTime >= line.time
            );

            if (nextLineIndex !== currentLineIndex) {
                currentLineIndex = nextLineIndex;
                currentWordIndex = -1; 
                lineChanged = true;
                
                // Annuler le timer et cacher TOUTES les images si on change de ligne
                if (imageTimer) {
                    clearTimeout(imageTimer);
                    imageTimer = null;
                }
                sequenceImageIds.forEach(id => document.getElementById(id).classList.remove('show'));
                lyricsContainer.style.opacity = '1'; 
            }

            const currentLine = lyricsData[currentLineIndex];

            if (currentLine) {
                // 4b. AFFICHAGE DE LA S√âQUENCE D'IMAGES
                if (currentLine.sequence && lineChanged) {
                    lyricsContainer.innerHTML = ""; // Efface les paroles
                    lyricsContainer.style.opacity = '0'; // On cache les paroles pendant les images
                    displayImageSequence(currentLine.sequence);
                }
                // 4c. AFFICHAGE SIMPLE (pour le message final)
                else if (currentLine.text) {
                    if (lineChanged || lyricsContainer.innerHTML === "") {
                        // Cacher toutes les images avant d'afficher le texte final
                        sequenceImageIds.forEach(id => document.getElementById(id).classList.remove('show'));

                        lyricsContainer.innerHTML = currentLine.text;
                        lyricsContainer.style.color = '#fff';
                        lyricsContainer.style.textShadow = '0 0 10px rgba(255,255,255,0.5)';
                        lyricsContainer.style.opacity = '1'; // R√©afficher les paroles
                    }
                } 
                // 4d. AFFICHAGE MOT PAR MOT (inchang√©)
                else if (currentLine.words) {
                    const words = currentLine.words;

                    if (lineChanged) {
                        lyricsContainer.style.color = '#fff'; 
                        lyricsContainer.style.textShadow = '0 0 10px rgba(255,255,255,0.5)';
                        
                        lyricsContainer.innerHTML = words.map(word => 
                            `<span class="word">${word.text}</span>`
                        ).join(' ');
                    }

                    const nextWordIndex = words.slice().reverse().findIndex(word => currentTime >= word.time);
                    const actualNextWordIndex = nextWordIndex === -1 ? -1 : words.length - 1 - nextWordIndex;

                    if (actualNextWordIndex !== currentWordIndex) {
                        currentWordIndex = actualNextWordIndex;
                        const wordSpans = lyricsContainer.querySelectorAll('.word');

                        wordSpans.forEach((span, index) => {
                            if (index <= currentWordIndex) {
                                span.classList.add('revealed');
                            } else {
                                span.classList.remove('revealed');
                            }
                        });
                    }
                }
            } else {
                // Rien √† afficher
            }
        });


        // G√©rer la fin de l'audio 
        audio.addEventListener('ended', () => {
            sequenceImageIds.forEach(id => document.getElementById(id).classList.remove('show'));
            lyricsContainer.style.opacity = '0';
            lyricsContainer.innerHTML = "";
        });

        // 5. G√©n√©rateur de neige et objets qui tombent (inchang√©s)
        function createSnow(count) {
            for(let i=0; i<count; i++) {
                const snow = document.createElement('div');
                snow.className = 'snowflake';
                snow.innerHTML = '‚ùÑ';
                snow.style.left = Math.random() * 100 + 'vw';
                snow.style.animationDuration = Math.random() * 8 + 5 + 's'; 
                snow.style.animationDelay = Math.random() * 5 + 's'; 
                snow.style.opacity = Math.random();
                snow.style.fontSize = Math.random() * 15 + 10 + 'px'; 
                document.body.appendChild(snow);
            }
        }

        const fallingEmojis = ['üéÅ', 'üéÑ', 'üéÖ', 'üîî', '‚ú®'];
        function createFallingItems(count) {
            for(let i=0; i<count; i++) {
                const item = document.createElement('div');
                item.className = 'falling-item';
                item.innerHTML = fallingEmojis[Math.floor(Math.random() * fallingEmojis.length)];
                
                item.style.left = Math.random() * 100 + 'vw';
                item.style.animationDuration = Math.random() * 10 + 8 + 's'; 
                item.style.animationDelay = Math.random() * 8 + 's'; 
                item.style.fontSize = Math.random() * 20 + 20 + 'px';
                
                item.style.setProperty('--end-x', (Math.random() * 40 - 20) + 'vw'); 
                item.style.setProperty('--end-rotation', (Math.random() * 720 - 360) + 'deg'); 
                
                document.body.appendChild(item);
            }
        }
    </script>
</body>
</html>


